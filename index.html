<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Nonchalant TOPUP</title>
<link href="static/image/logo.png " rel="shortcut icon" sizes="32x32" type="icon/jpg"/>
<link href="css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&amp;display=swap" rel="stylesheet"/>
</head>
<body>
<a class="support-button" href="https://t.me/Secod_admin" rel="noopener noreferrer" target="_blank">
<img alt="Support" src="images/logo.png"/>
</a>
<header onclick="location.reload()">
<div class="header-content">
<img alt="NONCHALANT TOPUP Logo" class="header-logo" src="images/logo.png">
<h1 class="header-title khmer-heading">NONCHALANT TOPUP</h1>
</img></div>
</header>
<main>
<!-- Main Banner Slider -->
<div class="banner-container frame">
<div class="banner-slider">
<div class="banner-slides">
<div class="banner-slide active">
<img alt="Nonchalant Topup Banner" class="banner-image" src="images/banner.jpg"/>
</div>
</div>
<div class="slider-nav" style="display: none;">
<button class="slider-prev">â®</button>
<div class="slider-dots"></div>
<button class="slider-next">â¯</button>
</div>
</div>
</div>
<!-- Special Offers Section
<section id="specialOffers" class="offers-container frame"> 
  <h6 class="section-title khmer-heading">SPECIAL OFFERS</h6>
  <div class="offers-slider">
    <div class="offer-slides">
      <div class="offer-slide">
        <div class="offer-image-container">
          <img src="/static/images/specailoffer-1.jpg" alt="Special Offer 1">
        </div>
      </div>
      <div class="offer-slide">
        <div class="offer-image-container">
          <img src="/static/images/specailoffer-2.jpg" alt="Special Offer 2">
        </div>
      </div>
    </div>
    <div class="slider-nav" style="display: none;">
      <button class="slider-prev">â®</button>
      <div class="slider-dots"></div>
      <button class="slider-next">â¯</button>
    </div>
  </div>
</section> -->
<!-- Homepage Section -->
<section class="homepage-section" id="homepage">
<h2 class="khmer-heading section-step">
<!-- <span class="step-number"></span> -->
<span class="step-text">á‡áŸ’ášá¾áŸášá¾áŸá áŸ’á‚áŸá˜áŠáŸ‚á›á¢áŸ’á“á€á…á„áŸ‹á‘á·á‰á–áŸá‡áŸ’á™</span>
</h2>
<div class="game-grid">
<div class="game-card" onclick="showMLTopup()">
<div class="game-image-container">
<img alt="Mobile Legend" class="game-image" src="images/mobile_legend.jpg">
</img></div>
<div class="game-title khmer-heading">MOBILE LEGEND</div>
<button class="khmer-heading">TOPUP</button>
<!-- MLBB PH MY SG -->
</div> 
<div class="game-card">
<div class="game-image-container">
<img alt="Mobile Legend PH MY SG" class="game-image" src="images/mobile_legendphmysg.jpg">
</img></div>
<div class="game-title khmer-heading">MLBB PH MY SG</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
<!-- MLBB Indo -->
</div>
<div class="game-card">
<div class="game-image-container">
<img alt="Mobile Legend INDO" class="game-image" src="images/mobile_legend_indo.jpg">
</img></div>
<div class="game-title khmer-heading">MLBB INDO</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
<!-- Free Fire Khmer -->
</div>
<div class="game-card" onclick="showFFTopup()">
<div class="game-image-container">
<img alt="Free Fire" class="game-image" src="images/free_fire.jpg">
</img></div>
<div class="game-title khmer-heading">FREE FIRE</div>
<button class="khmer-heading">TOPUP</button>
<!-- MLBB VN -->
</div>
<div class="game-card">
<div class="game-image-container">
<img alt="Free Fire VN" class="game-image" src="images/free_fire_vn.jpg"/>
</div>
<div class="game-title khmer-heading">FREE FIRE VN</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
<!-- MLBB TH -->
</div>
<div class="game-card">
<div class="game-image-container">
<img alt="Free Fire TH" class="game-image" src="images/free_fire_th.jpg"/>
</div>
<div class="game-title khmer-heading">FREE FIRE TH</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
</div>
<!-- In the game-grid section, replace the existing PUBG Mobile card with this: -->
<div class="game-card" onclick="showPUBGTopup()">
<div class="game-image-container">
<img alt="PUBG Mobile" class="game-image" src="images/pubg_mobile.jpg"/>
</div>
<div class="game-title khmer-heading">PUBG MOBILE</div>
<button class="khmer-heading">TOPUP</button>
<!-- HoK -->
</div>
<div class="game-card">
<div class="game-image-container">
<img alt="HOK" class="game-image" src="images/h_o_k.jpg"/>
</div>
<div class="game-title khmer-heading">HONOR OF KING</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
</div>
<!-- Blood Strick -->
<div class="game-card">
<div class="game-image-container">
<img alt="Blood Strike" class="game-image" src="images/blood_strike.jpg"/>
</div>
<div class="game-title khmer-heading">BLOOD STRIKE</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
<!--Mago=u -->
</div>
<div class="game-card">
<div class="game-image-container">
<img alt="Magic Chess" class="game-image" src="images/magic_chess.jpg"/>
</div>
<div class="game-title khmer-heading">MAGIC CHESS</div>
<div class="coming-soon khmer-heading">COMING SOON</div>
</div>
</div>
</section>
<section id="Title" style="display: none;">
<div class="frame">
<h2 class="khmer-heading" style="margin-bottom: 15px;">Top-up Mobile Legends, Free Fire</h2>
<p class="khmer-heading">á‘á·á‰á–áŸá‡áŸ’áš Mobile Legends: Bang Bang á€áŸ’á“á»á„áá˜áŸ’á›áŸƒáŸá˜ášá˜áŸ’á™! áá¶á˜ášá™áŸ‡á¢á¶á™áŒá¸ ID ášá”áŸáŸ‹á¢áŸ’á“á€, á‡áŸ’ášá¾áŸášá¾áŸá€á‰áŸ’á…á”áŸ‹á–áŸá‡áŸ’á™ áŠáŸ‚á›á¢áŸ’á“á€á–áŸá‰á…á·ááŸ’áá‘á·á‰, áŠáŸ„á™á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹áá¶á˜á˜á’áŸ’á™áŸ„á”á¶á™áŠáŸ‚á›á¢áŸ’á“á€á˜á¶á“, á–áŸá‡áŸ’ášá“á¹á„á”á‰áŸ’á‡á¼á“á‘áŸ…á€áŸ’á“á»á„á‚áá“áŸá™áŸ’á™ MLBB ášá”áŸáŸ‹á¢áŸ’á“á€á€áŸ’á“á»á„ášá™áŸ‡á–áŸá›á–á¸á…á“áŸ’á›áŸ„áŸ‡ 10á“á¶á‘á¸ áŠá›áŸ‹ 3á˜áŸ‰áŸ„á„áŸ”</p>
</div>
</section>
<!-- Lucky Popup or How To Topup -->
<div class="lucky-popup" id="luckyPopup" style="display: none;">
<div class="lucky-popup-content">
<span class="lucky-popup-close">Ã—</span>
<img alt="Lucky Popup Offer" src="images/HowToTopup-popup1.jpg"/>
</div>
</div>
<!-- Terms and Conditions Section (initially hidden) -->
<section id="termsSection" style="display: none;">
<div class="frame">
<h2 class="khmer-heading" style="margin-bottom: 15px;">Terms &amp; Condition</h2>
<p class="khmer-heading">áŸ¡. ááŸ’á‰á»áŸ†á™á›áŸ‹á–áŸ’ášá˜á…áŸ†á–áŸ„áŸ‡á€á¶ášá”á‰áŸ’á‡á¶ášá‘á·á‰á‘á¶áŸ†á„á¢áŸáŸ‹ á“á·á„á˜á·á“á˜á¶á“á€á¶ášâ€‹ á›á»á”á…áŸ„á› á¬â€‹ áŸá„á”áŸ’ášá¶á€áŸ‹áœá·á‰ á¡á¾á™</p>
<p class="khmer-heading">1. I agree to all orders and there is no cancellation or refund</p>
<button class="khmer-heading" onclick="hideTerms()" style="margin-top: 20px;">Back</button>
</div>
</section>
<!-- Mobile Legends Topup Section (initially hidden) -->
<section id="mlTopupSection" style="display: none;">
<section class="banner frame">
<div class="banner-content">
<div class="game-title-container">
<img alt="Mobile Legends Logo" class="game-logo" src="images/mlbb-logo1.png">
<h3 class="khmer-heading">Mobile Legend BANG BANG</h3>
</img></div>
<h3 class="khmer-heading">á‘á·á‰á–áŸá‡áŸ’áš Mobile Legends: Bang Bang á€áŸ’á“á»á„áá˜áŸ’á›áŸƒáŸá˜ášá˜áŸ’á™!</h3>
</div>
</section>
<h3 class="khmer-heading section-step">
<span class="step-number">1</span>
<span class="step-text">á”á‰áŸ’á…á¼á›á–áŸááŸŒá˜á¶á“</span>
</h3>
<section class="user-input frame">
<div class="input-row">
<input id="idInput" placeholder="Player ID" type="number"/>
<input id="zoneInput" placeholder="Zone ID" type="number"/>
</div>
<button onclick="checkUsername()">Check Username</button>
<div class="khmer-heading" id="usernameDisplay"></div>
</section>
<!-- Mobile Legends Special Offers Section -->
<section class="special-offers-section">
<h3 class="khmer-heading">ğŸ”¥ Mobile Legends Special Offers</h3>
<div class="frame">
<div class="pricing-grid" id="mlSpecialOffers">
<!-- Offers will be loaded dynamically -->
<div class="loading-placeholder khmer-heading">Loading special offers...</div>
</div>
</div>
</section>
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">2</span>
<span class="step-text">á‡áŸ’ášá¾áŸášá¾áŸá€á‰áŸ’á…á”áŸ‹</span>
</h3>
<div class="frame package-frame">
<div class="pricing-grid" id="packageGrid"></div>
</div>
</section>
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">3</span>
<span class="step-text">á€á¶ášá‘á¼á‘á¶ááŸ‹á”áŸ’ášá¶á€áŸ‹</span></h3>
<div class="khqr-card" id="khqrCard">
<h3 class="khmer-heading">KHQR</h3>
<div class="text-group">
</div>
<h6>Scan to pay with any banking app</h6>
<input id="khqrCheck" type="checkbox"/>
</div>
</section>
<!-- Step 4: Agreement -->
<section>
<h3 class="khmer-heading"></h3>
<div class="frame-agreement">
<label class="khmer-heading" style="display: flex; align-items: center; gap: 10px;">
<input id="mlAgreementCheck" type="checkbox"/>
      ááŸ’á‰á»áŸ†á™á›áŸ‹á–áŸ’ášá˜áá¶á˜ 
      <a href="javascript:void(0)" onclick="showTerms('ml')" style="color: #ffe600; text-decoration: underline;">
        á›á€áŸ’ááááŸ’áŒ
      </a>
</label>
</div>
</section>
<section class="banner frame">
<div class="banner-content">
<div class="game-title">
<img alt="Mobile Legends Logo" class="ml-logo" src="images/logo.png"/>
<h3 class="khmer-heading">â€‹ áŠá¶á€áŸ‹á—áŸ’á›á¶á˜â€‹â€‹ á…á¼á›á—áŸ’á›á»á…â€‹ </h3>
</div>
<h4 class="khmer-heading">áá˜áŸ’á›áŸƒáŸá˜ášá˜áŸ’á™ áŸá»áœááŸ’áá·á—á¶á– á“á·á„ á‘áŸ†á“á»á€á…á·ááŸ’á áŸáŸáœá¶á€á˜áŸ’á˜ášá áŸáŸ</h4>
</div>
</section>
</section>
<!-- Free Fire Topup Section (initially hidden) -->
<section id="ffTopupSection" style="display: none;">
<section class="banner frame">
<div class="banner-content">
<div class="game-title-container">
<img alt="Free Fire Logo" class="game-logo" src="images/ff-logo.jpg"/>
<h3 class="khmer-heading">FREE FIRE</h3>
</div>
<h3 class="khmer-heading">á‘á·á‰á–áŸá‡áŸ’áš Free Fire á€áŸ’á“á»á„áá˜áŸ’á›áŸƒáŸá˜ášá˜áŸ’á™!</h3>
</div>
</section>
<h3 class="khmer-heading section-step">
<span class="step-number">1</span>
<span class="step-text">á”á‰áŸ’á…á¼á›á–áŸááŸŒá˜á¶á“</span>
</h3>
<section class="user-input frame ff-check-wrapper">
<div class="ff-input-group">
<input class="ff-input" id="ffIdInput" placeholder="Player ID" type="number"/>
<button class="ff-check-button" onclick="checkFFUsername()">Check Username</button>
</div>
<div class="khmer-heading ff-username-result" id="ffUsernameDisplay"></div>
</section>
<!-- Free Fire Special Offers Section -->
<section class="special-offers-section">
<h3 class="khmer-heading">ğŸ”¥ Free Fire Special Offers</h3>
<div class="frame">
<div class="pricing-grid" id="ffSpecialOffers">
<!-- Offers will be loaded dynamically -->
<div class="loading-placeholder khmer-heading">Loading special offers...</div>
</div>
</div>
</section>
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">2</span>
<span class="step-text">á‡áŸ’ášá¾áŸášá¾áŸá€á‰áŸ’á…á”áŸ‹</span>
</h3>
<div class="frame">
<div class="pricing-grid" id="ffPackageGrid"></div>
</div>
</section>
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">3</span>
<span class="step-text">á€á¶ášá‘á¼á‘á¶ááŸ‹á”áŸ’ášá¶á€áŸ‹</span></h3>
<div class="khqr-card" id="ffKhqrCard">
<h3 class="khmer-heading">KHQR</h3>
<div class="text-group">
</div>
<h6>Scan to pay with any banking app</h6>
<input id="ffKhqrCheck" type="checkbox"/>
</div>
</section>
<!-- Step 4: Agreement -->
<section>
<h3 class="khmer-heading"></h3>
<div class="frame-agreement">
<label class="khmer-heading" style="display: flex; align-items: center; gap: 10px;">
<input id="ffAgreementCheck" type="checkbox"/>
      ááŸ’á‰á»áŸ†á™á›áŸ‹á–áŸ’ášá˜áá¶á˜ 
      <a href="javascript:void(0)" onclick="showTerms('ff')" style="color: #ffe600; text-decoration: underline;">
        á›á€áŸ’ááááŸ’áŒ
      </a>
</label>
</div>
</section>
<section class="banner frame">
<div class="banner-content">
<div class="game-title">
<img alt="Free Fire Logo" class="ff-logo" src="images/logo.png"/>
<h3 class="khmer-heading">áŠáŸ„áášá áŸáŸâ€‹ á á¾á™â€‹ááŸ‚á“</h3>
</div>
<h4 class="khmer-heading">áŠá¶á€áŸ‹á—áŸ’á›á¶á˜â€‹â€‹â€‹ á…á¼á›á—áŸ’á›á»á…â€‹</h4>
</div>
</section>
</section>
<!-- PUBG Mobile Topup Section (initially hidden) -->
<section id="pubgTopupSection" style="display: none;">
<section class="banner frame">
<div class="banner-content">
<div class="game-title-container">
<img alt="PUBG Mobile Logo" class="game-logo" src="images/pubg-logo.png"/>
<h3 class="khmer-heading">PUBG MOBILE</h3>
</div>
<h3 class="khmer-heading">Top-up PUBG Mobile UC at competitive prices!</h3>
</div>
</section>
<h3 class="khmer-heading section-step">
<span class="step-number">1</span>
<span class="step-text">Enter Player Information</span>
</h3>
<section class="user-input frame ff-check-wrapper">
<div class="ff-input-group">
<input class="ff-input" id="pubgIdInput" placeholder="Player ID" type="number"/>
<button class="ff-check-button" onclick="checkPUBGUsername()">Check Username</button>
</div>
<div class="khmer-heading ff-username-result" id="pubgUsernameDisplay"></div>
</section>
<!-- PUBG Mobile Special Offers Section -->
<section class="special-offers-section">
<h3 class="khmer-heading">ğŸ”¥ PUBG Mobile Special Offers</h3>
<div class="frame">
<div class="pricing-grid" id="pubgSpecialOffers">
<!-- Offers will be loaded dynamically -->
<div class="loading-placeholder khmer-heading">Loading special offers...</div>
</div>
</div>
</section>
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">2</span>
<span class="step-text">Select Package</span>
</h3>
<div class="frame">
<div class="pricing-grid" id="pubgPackageGrid"></div>
</div>
</section>
<!-- Payment and agreement sections similar to other games -->
<section class="package-section">
<h3 class="khmer-heading section-step">
<span class="step-number">3</span>
<span class="step-text">Payment Method</span>
</h3>
<div class="khqr-card" id="pubgKhqrCard">
<h3 class="khmer-heading">KHQR</h3>
<div class="text-group"></div>
<h6>Scan to pay with any banking app</h6>
<input id="pubgKhqrCheck" type="checkbox"/>
</div>
</section>
<section>
<h3 class="khmer-heading"></h3>
<div class="frame-agreement">
<label class="khmer-heading" style="display: flex; align-items: center; gap: 10px;">
<input id="pubgAgreementCheck" type="checkbox"/>
        I agree to the 
        <a href="javascript:void(0)" onclick="showTerms('pubg')" style="color: #ffe600; text-decoration: underline;">
          Terms &amp; Conditions
        </a>
</label>
</div>
</section>
<section class="banner frame">
<div class="banner-content">
<div class="game-title">
<img alt="PUBG Mobile Logo" class="pubg-logo" src="images/logo.jpg"/>
<h3 class="khmer-heading">More Information Please Contact Me</h3>
</div>
<h4 class="khmer-heading">Competitive prices, reliability, and fast service</h4>
</div>
</section>
</section>
</main>
<footer class="site-footer" id="mainFooter">
<!-- Centered logo and text section -->
<div class="footer-center">
<p class="khmer-heading footer-text">áŠá¶á€áŸ‹á…á¼á›á á¾á™á–á¼</p>
</div>
<!-- Left-aligned content sections -->
<div class="footer-content">
<div class="footer-section">
<h3 class="khmer-heading">About</h3>
<p class="khmer-heading">á á¶á˜áŠá¶á€áŸ‹á–áŸá‡áŸ’ášâ€‹ </p>
</div>
<div class="footer-section">
<h3 class="khmer-heading">Payment</h3>
<p class="khmer-heading">á™á¾á„á‘á‘á½á›á€á¶ášá”á„áŸ‹á”áŸ’ášá¶á€áŸ‹áá¶á˜ášá™áŸˆ KHQR</p>
</div>
<div class="footer-section">
<h3 class="khmer-heading">Contact us</h3>
<p class="khmer-heading">
    Telegram: 
    <a class="telegram-link" href="https://t.me/Second_admin" rel="noopener noreferrer" target="_blank">
      @Secon_admin
    </a>
</p>
</div>
<div class="footer-bottom">
<p class="khmer-heading" style="text-align: center; margin-top: 20px;">
<a href="javascript:void(0)" onclick="showTerms()" style="color: #ffe600; text-decoration: underline;">
        Privacy Policy | Terms and Conditions
      </a>
</p>
</div>
</div></footer>
<button class="khmer-heading" id="buyNowBtn" onclick="initiatePayment()" style="display: none;">Buy Now $0.00</button>
<!-- Bakong Payment Modal -->
<div class="modal" id="bakongModal">
<div class="modal-content">
<span class="close" onclick="closeModal()">Ã—</span>
<h2 class="khmer-heading">Bakong Payment</h2>
<div class="khmer-heading" id="bakongStatus">Ready to generate payment QR</div>
<div class="qr-container">
<div class="qr-image">
<img alt="QR Code" id="bakongQR" src=""/>
</div>
</div>
<div class="khmer-heading" id="bakongCountdown"></div>
<div class="modal-buttons">
<button class="bakong-btn khmer-heading" disabled="" id="checkPaymentBtn" onclick="checkBakongPayment()">Check Payment</button>
<button class="bakong-btn khmer-heading" onclick="closeModal()">Cancel</button>
</div>
</div>
</div>
<!-- Invoice Modal -->
<div class="modal" id="invoiceModal">
<div class="modal-content">
<span class="close" onclick="closeInvoiceModal()">Ã—</span>
<h2 class="khmer-heading">Payment Successful</h2>
<div class="invoice-details">
<div class="invoice-row">
<span class="invoice-icon">ğŸ‘¤</span>
<span class="invoice-label khmer-heading">Username:</span>
<span class="invoice-value khmer-heading" id="invoice-username"></span>
</div>
<div class="invoice-row">
<span class="invoice-icon">ğŸ†”</span>
<span class="invoice-label khmer-heading">Player ID:</span>
<span class="invoice-value khmer-heading" id="invoice-playerid"></span>
</div>
<div class="invoice-row">
<span class="invoice-icon">ğŸŒ</span>
<span class="invoice-label khmer-heading">Zone ID:</span>
<span class="invoice-value khmer-heading" id="invoice-zoneid"></span>
</div>
<div class="invoice-row">
<span class="invoice-icon">ğŸ®</span>
<span class="invoice-label khmer-heading">Package:</span>
<span class="invoice-value khmer-heading" id="invoice-package"></span>
</div>
<div class="invoice-row">
<span class="invoice-icon">ğŸ’µ</span>
<span class="invoice-label khmer-heading">Amount:</span>
<span class="invoice-value khmer-heading" id="invoice-amount"></span>
</div>
<div class="invoice-row">
<span class="invoice-icon">ğŸ“…</span>
<span class="invoice-label khmer-heading">Date:</span>
<span class="invoice-value khmer-heading" id="invoice-date"></span>
</div>
</div>
<div class="modal-buttons">
<button class="bakong-btn khmer-heading" onclick="downloadInvoicePDF()">Download Receipt</button>
<button class="bakong-btn khmer-heading" onclick="backToTopup()">Back to Top-up</button>
</div>
</div>
<script>
   // Global variables to store packages
let gamePackages = {
    ml: [],
    ff: [],
    pubg: [],
    ml_special_offers: [],
    ff_special_offers: [],
    pubg_special_offers: []
};
let selectedPrice = 0;
let selectedName = "";
let currentTransaction = null;

// Load all packages from server
async function loadAllPackages() {
    try {
        const response = await fetch('/get_packages');
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();

        gamePackages = {
            ml: Array.isArray(data.ml) ? data.ml : [],
            ff: Array.isArray(data.ff) ? data.ff : [],
            pubg: Array.isArray(data.pubg) ? data.pubg : [],
            ml_special_offers: Array.isArray(data.ml_special_offers) ? data.ml_special_offers : [],
            ff_special_offers: Array.isArray(data.ff_special_offers) ? data.ff_special_offers : [],
            pubg_special_offers: Array.isArray(data.pubg_special_offers) ? data.pubg_special_offers : []
        };

        console.log('Packages loaded successfully:', gamePackages);
    } catch (error) {
        console.error('Error loading packages:', error);
    }
}

// Initialize package and offer grids
function initPackageGrids() {
    const mappings = [
        { gameType: 'ml', gridId: 'packageGrid', offersId: 'mlSpecialOffers' },
        { gameType: 'ff', gridId: 'ffPackageGrid', offersId: 'ffSpecialOffers' },
        { gameType: 'pubg', gridId: 'pubgPackageGrid', offersId: 'pubgSpecialOffers' }
    ];

    mappings.forEach(({ gameType, gridId, offersId }) => {
        // Packages
        const pkgGrid = document.getElementById(gridId);
        pkgGrid.innerHTML = '';
        gamePackages[gameType].forEach(pkg => {
            const card = createPackageCard(pkg, gameType);
            pkgGrid.appendChild(card);
        });

        // Special offers
        const offerGrid = document.getElementById(offersId);
        offerGrid.innerHTML = '';
        gamePackages[`${gameType}_special_offers`].forEach(offer => {
            const card = createSpecialOfferCard(offer, gameType);
            offerGrid.appendChild(card);
        });
    });
}

// Create a regular package card
function createPackageCard(pkg, gameType) {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.name = pkg.name;
    card.dataset.price = pkg.price;

    const imagePath = pkg.image
        ? `/static/images/${pkg.image}`
        : `/static/images/${gameType}-${gameType === 'pubg' ? 'uc' : 'diamond'}.jpg`;

    const displayName = gameType === 'pubg'
        ? `${pkg.name} UC`
        : (pkg.name.includes('Weekly') || pkg.name.includes('Monthly') || pkg.name.includes('Evo') || pkg.name.includes('lite') || pkg.name.includes('Pass'))
            ? pkg.name
            : `${pkg.name} Diamonds`;

    card.innerHTML = `
        <img src="${imagePath}" alt="${gameType} package" />
        <h2 class="khmer-heading">${displayName}</h2>
        <p class="new-price khmer-heading">$${parseFloat(pkg.price).toFixed(2)}</p>
    `;

    card.onclick = () => selectPackage(card, pkg.price, pkg.name, gameType);
    return card;
}

// Create a special offer card
function createSpecialOfferCard(offer, gameType) {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.name = offer.name;
    card.dataset.price = offer.price;

    const imagePath = offer.image
        ? `/static/images/${offer.image}`
        : `/static/images/${gameType}-${gameType === 'pubg' ? 'uc' : 'diamond'}.jpg`;

    const displayName = gameType === 'pubg'
        ? `${offer.name} UC`
        : `${offer.name} Diamonds`;

    card.innerHTML = `
        <img src="${imagePath}" alt="${gameType} special offer" />
        <h2 class="khmer-heading">${displayName}</h2>
        <p class="new-price khmer-heading">$${parseFloat(offer.price).toFixed(2)}</p>
        <p class="special-badge khmer-heading">SPECIAL OFFER</p>
    `;

    card.onclick = () => selectSpecialOffer(card, offer.price, offer.name, gameType);
    return card;
}

// Handle regular package selection
function selectPackage(card, price, name, gameType) {
    const grid = card.parentElement;

    // Deselect all in this grid
    document.querySelectorAll(`#${grid.id} .card`).forEach(c => c.classList.remove('selected'));

    // Deselect special offers
    document.querySelectorAll(`#${gameType}SpecialOffers .card`).forEach(c => c.classList.remove('selected'));

    card.classList.add('selected');
    selectedPrice = price;
    selectedName = name;
    updateBuyButton();
}

// Handle special offer selection
function selectSpecialOffer(card, price, name, gameType) {
    document.querySelectorAll(`#${gameType}SpecialOffers .card`).forEach(c => c.classList.remove('selected'));

    const gridId = gameType === 'ml' ? 'packageGrid' :
                   gameType === 'ff' ? 'ffPackageGrid' :
                   'pubgPackageGrid';

    document.querySelectorAll(`#${gridId} .card`).forEach(c => c.classList.remove('selected'));

    card.classList.add('selected');
    selectedPrice = price;
    selectedName = name;
    updateBuyButton();
}

// Update Buy Button Text
function updateBuyButton() {
    const buyBtn = document.getElementById('buyNowBtn');
    buyBtn.textContent = selectedPrice > 0
        ? `Buy Now $${selectedPrice.toFixed(2)}`
        : 'Buy Now $0.00';
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', async function () {
    await loadAllPackages();
    initPackageGrids();

    let selectedPrice = 0;
    let selectedName = "";
    let currentTransaction = null;
    let countdownInterval = null;
});
    function showMLTopup() {
      document.getElementById('homepage').style.display = 'none';
      document.getElementById('mlTopupSection').style.display = 'block';
      document.getElementById('ffTopupSection').style.display = 'none';
      document.getElementById('buyNowBtn').style.display = 'block';
      document.getElementById('mainFooter').style.display = 'none';
      window.scrollTo(0, 0);
      selectedPrice = 0;
      selectedName = "";
      document.getElementById('buyNowBtn').textContent = 'Buy Now $0.00';
    }

    function showFFTopup() {
      document.getElementById('homepage').style.display = 'none';
      document.getElementById('ffTopupSection').style.display = 'block';
      document.getElementById('mlTopupSection').style.display = 'none';
      document.getElementById('buyNowBtn').style.display = 'block';
      document.getElementById('mainFooter').style.display = 'none';
      window.scrollTo(0, 0);
      selectedPrice = 0;
      selectedName = "";
      document.getElementById('buyNowBtn').textContent = 'Buy Now $0.00';
    }

    // Add this function
function showPUBGTopup() {
    document.getElementById('homepage').style.display = 'none';
    document.getElementById('pubgTopupSection').style.display = 'block';
    document.getElementById('mlTopupSection').style.display = 'none';
    document.getElementById('ffTopupSection').style.display = 'none';
    document.getElementById('buyNowBtn').style.display = 'block';
    document.getElementById('mainFooter').style.display = 'none';
    window.scrollTo(0, 0);
    selectedPrice = 0;
    selectedName = "";
    document.getElementById('buyNowBtn').textContent = 'Buy Now $0.00';
}
    async function checkUsername() {
      const id = document.getElementById('idInput').value.trim();
      const zone = document.getElementById('zoneInput').value.trim();
      const display = document.getElementById('usernameDisplay');
      if (!id || !zone) {
        display.textContent = "username not found!.";
        return;
      }
      display.textContent = "Checking username...";
      try {
        const url = `https://api.isan.eu.org/nickname/ml?id=${encodeURIComponent(id)}&zone=${encodeURIComponent(zone)}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.success && data.name) {
          display.textContent = `âœ… Username: ${data.name}`;
        } else {
          display.textContent = "âŒ Username not found.";
        }
      } catch (err) {
        display.textContent = "âš ï¸ Error fetching data.";
      }
    }

// Add this function to check PUBG username
async function checkPUBGUsername() {
    const uid = document.getElementById('pubgIdInput').value.trim();
    const display = document.getElementById('pubgUsernameDisplay');

    if (!uid) {
        display.textContent = "âŒ Please enter a Player ID.";
        display.style.color = "white";
        return;
    }

    display.textContent = "Checking username...";
    display.style.color = "white";

    try {
        const response = await fetch(`https://luffytopup.com/api/v1/verify_account.php?id=${uid}&zone=0000&game=pubgm`);
        const data = await response.json();

        if (data.success && data.name) {
            display.textContent = `âœ… Username: ${data.name}`;
            display.style.color = "white";
        } else {
            display.textContent = "âŒ Username not found.";
            display.style.color = "white";
        }
    } catch (error) {
        display.textContent = "âš ï¸ Error fetching username.";
        display.style.color = "white";
        console.error(error);
    }
}


    function openModal() {
      document.getElementById('bakongModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('bakongModal').style.display = 'none';
      if (countdownInterval) clearInterval(countdownInterval);
      currentTransaction = null;
    }

    function closeInvoiceModal() {
      document.getElementById('invoiceModal').style.display = 'none';
    }
let countdownInterval = null;
function initiatePayment() {
    let id, zone, isML = false, isFF = false, isPUBG = false;

    if (document.getElementById('mlTopupSection').style.display === 'block') {
        isML = true;
        id = document.getElementById('idInput').value.trim();
        zone = document.getElementById('zoneInput').value.trim();
    } else if (document.getElementById('ffTopupSection').style.display === 'block') {
        isFF = true;
        id = document.getElementById('ffIdInput').value.trim();
        zone = "0";
    } else if (document.getElementById('pubgTopupSection').style.display === 'block') {
        isPUBG = true;
        id = document.getElementById('pubgIdInput').value.trim();
        zone = "0"; // PUBG doesn't use zone IDs
    }

    const khqr = isML ? document.getElementById('khqrCheck').checked :
               isFF ? document.getElementById('ffKhqrCheck').checked :
               document.getElementById('pubgKhqrCheck').checked;

    const agreed = isML ? document.getElementById('mlAgreementCheck').checked :
                  isFF ? document.getElementById('ffAgreementCheck').checked :
                  document.getElementById('pubgAgreementCheck').checked;

    if (!id) {
        alert('Please fill Player ID.');
        return;
    }

    if (!selectedName) {
        alert('Please select a package.');
        return;
    }

    if (!khqr) {
        alert('Please check KHQR payment method.');
        return;
    }

    if (!agreed) {
        alert('áŸá¼á˜á’áŸ’áœá¾á€á¶ášá™á›áŸ‹á–áŸ’ášá˜á“á¹á„á›á€áŸ’ááááŸ’áŒá˜á»á“á–áŸá›á”á“áŸ’á!');
        return;
    }

    openModal();
    generateBakongQR(id, zone);
}

  
async function generateBakongQR(playerId, zoneId) {
  try {
    const gameType = document.getElementById('mlTopupSection').style.display === 'block' ? 'ml' : 'ff';
    
    const response = await fetch('/generate_qr', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        amount: selectedPrice,
        player_id: playerId,
        zone_id: zoneId,
        package: selectedName,
        game_type: gameType
      })
    });
    
    const result = await response.json();
    
    if (!response.ok) {
      throw new Error(result.error || 'Failed to generate QR');
    }
    
    // Store current transaction
    currentTransaction = {
      id: result.transaction_id,
      amount: result.amount,
      expiry: new Date(result.expiry),
      playerId: playerId,
      zoneId: zoneId,
      package: selectedName
    };
    
    // Display QR code
    document.getElementById('bakongQR').src = `data:image/png;base64,${result.qr_image}`;
    
    // Enable check button and update text
    const checkBtn = document.getElementById('checkPaymentBtn');
    checkBtn.disabled = false;
    checkBtn.textContent = 'Checking...';
    
    // Update status
    document.getElementById('bakongStatus').textContent = `Scan to pay $${selectedPrice.toFixed(2)}`;
    
    // Start countdown and auto-checking
    startCountdown();
    startAutoPaymentCheck();
    
  } catch (error) {
    document.getElementById('bakongStatus').textContent = `Error: ${error.message}`;
    document.getElementById('bakongStatus').style.color = '#f44336';
    console.error('QR Generation Error:', error);
    
    // Ensure auto-check is stopped if there was an error
    stopAutoPaymentCheck();
  }
}

// Auto-check payment functions
let paymentCheckInterval = null;

function startAutoPaymentCheck() {
  // Clear any existing interval
  stopAutoPaymentCheck();
  
  // Initial immediate check
  checkBakongPayment();
  
  // Set up recurring checks every 5 seconds
  paymentCheckInterval = setInterval(() => {
    checkBakongPayment();
  }, 5000);
}

function stopAutoPaymentCheck() {
  if (paymentCheckInterval) {
    clearInterval(paymentCheckInterval);
    paymentCheckInterval = null;
  }
  document.getElementById('checkPaymentBtn').textContent = 'Check Payment';
}

// Modified checkBakongPayment function
async function checkBakongPayment() {
  if (!currentTransaction) {
    stopAutoPaymentCheck();
    return;
  }

  try {
    const response = await fetch('/check_payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        transaction_id: currentTransaction.id
      })
    });
    
    const result = await response.json();
    
    if (!response.ok) {
      throw new Error(result.error || 'Payment check failed');
    }
    
    if (result.status === 'PAID') {
      stopAutoPaymentCheck();
      document.getElementById('bakongCountdown').textContent = 'Payment Received!';
      document.getElementById('bakongCountdown').style.color = '#4caf50';
      document.getElementById('bakongStatus').textContent = result.message;
      showInvoice(currentTransaction);
      setTimeout(closeModal, 500);
    } 
    else if (result.status === 'EXPIRED') {
      stopAutoPaymentCheck();
      document.getElementById('bakongCountdown').textContent = 'QR Code Expired';
      document.getElementById('bakongCountdown').style.color = '#f44336';
      document.getElementById('bakongStatus').textContent = result.message;
    }
    else {
      document.getElementById('bakongStatus').textContent = 'Waiting for payment...';
    }
  } catch (error) {
    console.error('Payment Check Error:', error);
    document.getElementById('bakongStatus').textContent = 'Error checking payment';
    document.getElementById('bakongStatus').style.color = '#f44336';
    stopAutoPaymentCheck();
  }
}

    function startCountdown() {
      if (countdownInterval) clearInterval(countdownInterval);
      updateCountdown();
      countdownInterval = setInterval(updateCountdown, 1000);
    }

    function updateCountdown() {
      if (!currentTransaction) return;
      
      const now = new Date();
      const remaining = currentTransaction.expiry - now;
      
      if (remaining <= 0) {
        clearInterval(countdownInterval);
        document.getElementById('bakongCountdown').textContent = 'QR Code Expired';
        document.getElementById('bakongCountdown').style.color = '#f44336';
        document.getElementById('checkPaymentBtn').disabled = true;
        document.getElementById('bakongStatus').textContent = 'QR expired. Please try again.';
        return;
      }
      
      const mins = Math.floor(remaining / 60000);
      const secs = Math.floor((remaining % 60000) / 1000);
      const countdownText = `Expires in: ${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      
      document.getElementById('bakongCountdown').textContent = countdownText;
      document.getElementById('bakongCountdown').style.color = (mins === 0 && secs < 30) ? '#f44336' : 'white';
    }

    async function checkBakongPayment() {
      if (!currentTransaction) {
        // alert('No active transaction to check');
        return;
      }
      
      // Disable button during check
      document.getElementById('checkPaymentBtn').disabled = true;
      document.getElementById('bakongStatus').textContent = 'Checking payment...';
      
      try {
        const response = await fetch('/check_payment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: new URLSearchParams({
            transaction_id: currentTransaction.id
          })
        });
        
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.error || 'Payment check failed');
        }
        
        if (result.status === 'PAID') {
          // Payment successful
          clearInterval(countdownInterval);
          document.getElementById('bakongCountdown').textContent = 'Payment Received!';
          document.getElementById('bakongCountdown').style.color = '#4caf50';
          document.getElementById('bakongStatus').textContent = result.message;
          
          // Show invoice
          showInvoice(currentTransaction);
          
          // Close payment modal after 0.5 second
          setTimeout(closeModal, 500);
        } else if (result.status === 'EXPIRED') {
          clearInterval(countdownInterval);
          document.getElementById('bakongCountdown').textContent = 'QR Code Expired';
          document.getElementById('bakongCountdown').style.color = '#f44336';
          document.getElementById('bakongStatus').textContent = result.message;
        } else {
          document.getElementById('bakongStatus').textContent = result.message;
          document.getElementById('checkPaymentBtn').disabled = false;
        }
      } catch (error) {
        document.getElementById('bakongStatus').textContent = `Error: ${error.message}`;
        document.getElementById('bakongStatus').style.color = '#f44336';
        document.getElementById('checkPaymentBtn').disabled = false;
        console.error(error);
      }
    }

    function showInvoice(transaction) {
  const now = new Date();
  let username = "N/A";

  // Determine which section is active and extract the username
  if (document.getElementById('mlTopupSection').style.display === 'block') {
    username = document.getElementById('usernameDisplay').textContent;
    if (username.includes('âœ… Username: ')) {
      username = username.replace('âœ… Username: ', '');
    }
  } else if (document.getElementById('ffTopupSection').style.display === 'block') {
    username = document.getElementById('ffUsernameDisplay').textContent;
    if (username.includes('âœ… Username: ')) {
      username = username.replace('âœ… Username: ', '');
    }
  }

  // Fill invoice details
  document.getElementById('invoice-username').textContent = username || 'N/A';
  document.getElementById('invoice-playerid').textContent = transaction.playerId;
  document.getElementById('invoice-zoneid').textContent = transaction.zoneId;
  document.getElementById('invoice-package').textContent = transaction.package;
  document.getElementById('invoice-amount').textContent = `$${transaction.amount.toFixed(2)}`;
  document.getElementById('invoice-date').textContent = now.toLocaleString();

  // Show the invoice modal
  document.getElementById('invoiceModal').style.display = 'flex';
}
    function backToTopup() {
      closeInvoiceModal();
      
      // Reset form
      if (document.getElementById('mlTopupSection').style.display === 'block') {
        document.getElementById('idInput').value = '';
        document.getElementById('zoneInput').value = '';
        document.getElementById('usernameDisplay').textContent = '';
        document.getElementById('khqrCheck').checked = false;
      } else {
        document.getElementById('ffIdInput').value = '';
        document.getElementById('ffKhqrCheck').checked = false;
      }
      
      // Reset package selection
      if (document.getElementById('mlTopupSection').style.display === 'block') {
        document.querySelectorAll('#packageGrid .card').forEach(c => c.classList.remove('selected'));
      } else {
        document.querySelectorAll('#ffPackageGrid .card').forEach(c => c.classList.remove('selected'));
      }
      
      document.getElementById('buyNowBtn').textContent = 'Buy Now $0.00';
      
      // Scroll to top
      window.scrollTo(0, 0);
    }
    async function checkFFUsername() {
  const uid = document.getElementById('ffIdInput').value.trim();
  const display = document.getElementById('ffUsernameDisplay');

  if (!uid) {
    display.textContent = "âŒ Please enter a Player ID.";
    display.style.color = "white";
    return;
  }

  display.textContent = "Checking username...";
  display.style.color = "white";

  try {
    const proxyUrl = 'https://api.allorigins.win/raw?url=';
    const targetUrl = encodeURIComponent(`https://wlx-ban-check.vercel.app/get_region?uid=${uid}`);
    const response = await fetch(proxyUrl + targetUrl);

    if (!response.ok) throw new Error("Network response was not ok");

    const data = await response.json();

    if (data.nickname) {
      display.textContent = `âœ… Username: ${data.nickname}`;
      display.style.color = "white";
    } else {
      display.textContent = "âŒ Username not found.";
      display.style.color = "white";
    }
  } catch (error) {
    display.textContent = "âš ï¸ Error fetching username.";
    display.style.color = "white";
    console.error(error);
  }
}

  </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
async function downloadInvoicePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", "a4");
  const pw = doc.internal.pageSize.getWidth();

  const nowStr = document.getElementById("invoice-date").textContent;
  const dateOnly = nowStr.split(",")[0].trim();
  const timeOnly = nowStr.split(",")[1] ? nowStr.split(",")[1].trim() : "";

  const playerId = document.getElementById("invoice-playerid").textContent;
  const zoneId = document.getElementById("invoice-zoneid").textContent;
  const pkg = document.getElementById("invoice-package").textContent;
  const priceStr = document.getElementById("invoice-amount").textContent;

  // Generate invoice number with seconds (INVNO-YYYYMMDDHHMMSS)
  const now = new Date();
  const invoiceNumber = `INVNO-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;

  const logo = new Image();
  logo.src = "/static/images/logo.jpg";

  logo.onload = () => {
    // Logo
    doc.addImage(logo, "JPEG", 15, 12, 22, 20);

    // Company name
    doc.setFont("Helvetica", "bold");
    doc.setFontSize(12);
    doc.text("MENG TOPUP", 15, 35);

    // Date
    doc.setFont("Helvetica", "normal");
    doc.setFontSize(10);
    doc.text(dateOnly, 15, 41);

    // Invoice number (bold and slightly larger)
    doc.setFont("Helvetica", "bold");
    doc.setFontSize(11);
    doc.text(`Invoice: ${invoiceNumber}`, 15, 47);

    // Contact info (right aligned)
    doc.setFontSize(9);
    const addr = [
      "johnrorha@gmail.com",
      "Adong tmar, Prey Nob, Sihanouk City, Cambodia"
    ];
    let ay = 12, ax = pw - 15;
    addr.forEach(line => { doc.text(line, ax, ay, { align: "right" }); ay += 5; });

    // Invoice title
    doc.setFont("Helvetica", "bold");
    doc.setFontSize(20);
    doc.text("INVOICE", pw / 2, 50, { align: "center" });

    // Divider line
    doc.setDrawColor(0); doc.setLineWidth(0.3);
    doc.line(25, 56, pw - 25, 56);

    // User info box
    const boxW = 100, boxH = 12, boxX = (pw - boxW) / 2, boxY = 62;
    doc.roundedRect(boxX, boxY, boxW, boxH, 2, 2);
    doc.setFontSize(12);
    doc.text(`User: ${playerId} (${zoneId})`, pw / 2, boxY + 8, { align: "center" });

    // Details table
    const desc = /weekly|monthly|pass/i.test(pkg) ? `${pkg} Pass` : /diamond/i.test(pkg) ? pkg : `${pkg} Diamonds`;
    doc.autoTable({
      head: [["Item", "Details"]],
      body: [
        ["Package", desc],
        ["Price", priceStr],
        ["Time", timeOnly],
        ["Status", "Successful"],
        ["Invoice No", invoiceNumber]
      ],
      startY: boxY + boxH + 10,
      tableWidth: 160,
      margin: { left: (pw - 160) / 2 },
      styles: { halign: "center", valign: "middle", fontSize: 11 },
      headStyles: { fillColor: [230,230,255], textColor: 0, fontStyle: "bold" },
      bodyStyles: { fillColor: [245,245,245] }
    });

    // Footer
    const footerY = doc.lastAutoTable.finalY + 15;
    doc.setFont("Helvetica", "normal");
    doc.setFontSize(9);
    doc.setTextColor(120);
    doc.text("Thank you for your purchase.", pw / 2, footerY, { align: "center" });

    // Save PDF
    doc.save(`invoice-${playerId}.pdf`);
  };
}
let returnSection = null;

function showTerms(fromSection = null) {
  returnSection = fromSection;

  document.getElementById('homepage').style.display = 'none';
  document.getElementById('mlTopupSection').style.display = 'none';
  document.getElementById('ffTopupSection').style.display = 'none';
  document.getElementById('pubgTopupSection').style.display = 'none';
  document.getElementById('termsSection').style.display = 'block';
  document.getElementById('buyNowBtn').style.display = 'none';

  const banner = document.querySelector('.home-banner');
  if (banner) banner.style.display = 'none';

  window.scrollTo(0, 0);
}

function hideTerms() {
  document.getElementById('termsSection').style.display = 'none';

  if (returnSection === 'ml') {
    document.getElementById('mlTopupSection').style.display = 'block';
    document.getElementById('buyNowBtn').style.display = 'block';
  } else if (returnSection === 'ff') {
    document.getElementById('ffTopupSection').style.display = 'block';
    document.getElementById('buyNowBtn').style.display = 'block';
    } else if (returnSection === 'pubg') {
    document.getElementById('pubgTopupSection').style.display = 'block';
    document.getElementById('buyNowBtn').style.display = 'block';
  } else {
    document.getElementById('homepage').style.display = 'block';
    document.getElementById('mainFooter').style.display = 'block';
  }

  const banner = document.querySelector('.home-banner');
  if (banner) banner.style.display = 'block';

  window.scrollTo(0, 0);
}

// Show offers only on homepage
document.addEventListener('DOMContentLoaded', function() {
  const homepageSection = document.getElementById('homepage');
  const specialOffers = document.getElementById('specialOffers');
  
  function checkActiveSection() {
    if (homepageSection.style.display !== 'none') {
      specialOffers.style.display = 'block';
    } else {
      specialOffers.style.display = 'none';
    }
  }
  
  // Initial check
  checkActiveSection();
  
  // Re-check when sections change
  const observer = new MutationObserver(checkActiveSection);
  observer.observe(homepageSection, { attributes: true, attributeFilter: ['style'] });
});

// Initialize all sliders
document.addEventListener('DOMContentLoaded', function() {
  // Initialize banner slider
  initSlider('.banner-slider');
  
  // Initialize offers slider (only when visible)
  const offersSlider = document.querySelector('.offers-slider');
  if (offersSlider) {
    initSlider('.offers-slider');
  }
  
  // Show offers only on homepage
  const homepageSection = document.getElementById('homepage');
  const specialOffers = document.getElementById('specialOffers');
  
  function checkActiveSection() {
    if (homepageSection.style.display !== 'none') {
      specialOffers.style.display = 'block';
      initSlider('.offers-slider'); // Re-init if needed
    } else {
      specialOffers.style.display = 'none';
    }
  }
  
  // Initial check
  checkActiveSection();
  
  // Re-check when sections change
  const observer = new MutationObserver(checkActiveSection);
  observer.observe(homepageSection, { attributes: true, attributeFilter: ['style'] });
});

// Generic slider initialization
function initSlider(selector) {
  const container = document.querySelector(selector);
  if (!container) return;
  
  const slides = container.querySelector('.slider-slides') || container.querySelector('.banner-slides') || container.querySelector('.offer-slides');
  const slideItems = slides.querySelectorAll('.banner-slide, .offer-slide');
  const dotsContainer = container.querySelector('.slider-dots');
  const prevBtn = container.querySelector('.slider-prev');
  const nextBtn = container.querySelector('.slider-next');
  
  let currentIndex = 0;
  const slideCount = slideItems.length;
  
  // Create dots if they don't exist
  if (dotsContainer && dotsContainer.children.length === 0) {
    for (let i = 0; i < slideCount; i++) {
      const dot = document.createElement('div');
      dot.classList.add('slider-dot');
      if (i === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToSlide(i));
      dotsContainer.appendChild(dot);
    }
  }
  
  // Navigation functions
  function goToSlide(index) {
    currentIndex = index;
    updateSlider();
  }
  
  function updateSlider() {
    slides.style.transform = `translateX(-${currentIndex * 100}%)`;
    
    // Update dots
    if (dotsContainer) {
      const dots = dotsContainer.querySelectorAll('.slider-dot');
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }
  }
  
  // Event listeners
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex > 0) ? currentIndex - 1 : slideCount - 1;
      updateSlider();
    });
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex < slideCount - 1) ? currentIndex + 1 : 0;
      updateSlider();
    });
  }
  
  // Auto-rotation
  let autoSlide = setInterval(() => {
    currentIndex = (currentIndex < slideCount - 1) ? currentIndex + 1 : 0;
    updateSlider();
  }, 5000);
  
  // Pause on hover
  container.addEventListener('mouseenter', () => clearInterval(autoSlide));
  container.addEventListener('mouseleave', () => {
    autoSlide = setInterval(() => {
      currentIndex = (currentIndex < slideCount - 1) ? currentIndex + 1 : 0;
      updateSlider();
    }, 5000);
  });
  
  // Touch support for mobile
  let touchStartX = 0;
  let touchEndX = 0;
  
  slides.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
    clearInterval(autoSlide);
  }, {passive: true});
  
  slides.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
    autoSlide = setInterval(() => {
      currentIndex = (currentIndex < slideCount - 1) ? currentIndex + 1 : 0;
      updateSlider();
    }, 5000);
  }, {passive: true});
  
  function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
      // Swipe left - next
      currentIndex = (currentIndex < slideCount - 1) ? currentIndex + 1 : 0;
    } else if (touchEndX > touchStartX + 50) {
      // Swipe right - prev
      currentIndex = (currentIndex > 0) ? currentIndex - 1 : slideCount - 1;
    }
    updateSlider();
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Check if popup was closed in the last 1 hour (3600000 ms)
  const popupClosedAt = localStorage.getItem('popupClosedAt');
  const oneHour = 3600000;
  
  if (!popupClosedAt || (Date.now() - popupClosedAt) > oneHour) {
    setTimeout(function() {
      const popup = document.getElementById('luckyPopup');
      popup.style.display = 'flex';
      
      // Close button functionality
      document.querySelector('.lucky-popup-close').onclick = function() {
        popup.style.display = 'none';
        localStorage.setItem('popupClosedAt', Date.now());
      };
      
      // Close when clicking outside
      popup.onclick = function(e) {
        if (e.target === this) {
          this.style.display = 'none';
          localStorage.setItem('popupClosedAt', Date.now());
        }
      };
    }, 1000); // Show after 1 second delay
  }
});

// Add these at the top with your other variables
const STORAGE_KEY = 'mengTopupPrefs';
let rememberedPrefs = {};

// Add this new function to load saved preferences
function loadRememberedPrefs() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    rememberedPrefs = JSON.parse(saved);
    
    // Fill ML fields if available
    if (rememberedPrefs.ml) {
      document.getElementById('idInput').value = rememberedPrefs.ml.playerId || '';
      document.getElementById('zoneInput').value = rememberedPrefs.ml.zoneId || '';
    }
    
    // Fill FF field if available
    if (rememberedPrefs.ff) {
      document.getElementById('ffIdInput').value = rememberedPrefs.ff.playerId || '';
    }
  }
}

// Add this new function to save preferences
function saveRememberedPrefs() {
  const gameType = document.getElementById('mlTopupSection').style.display === 'block' ? 'ml' : 'ff';
  
  if (gameType === 'ml') {
    rememberedPrefs.ml = {
      playerId: document.getElementById('idInput').value.trim(),
      zoneId: document.getElementById('zoneInput').value.trim()
    };
  } else {
    rememberedPrefs.ff = {
      playerId: document.getElementById('ffIdInput').value.trim()
    };
  }
  
  localStorage.setItem(STORAGE_KEY, JSON.stringify(rememberedPrefs));
}

// Add this to your DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
  loadRememberedPrefs();
  
  // Add event listeners to save when fields change
  document.getElementById('idInput').addEventListener('input', saveRememberedPrefs);
  document.getElementById('zoneInput').addEventListener('input', saveRememberedPrefs);
  document.getElementById('ffIdInput').addEventListener('input', saveRememberedPrefs);
});
</script>
</div></body>
</html>